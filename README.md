# 121GW Firmware Template

This repository contains a template project for 121GW firmware development, generated by [STM32CubeMX](http://www.st.com/en/development-tools/stm32cubemx.html) and intended for use with [SystemWorkbench](http://www.st.com/en/development-tools/sw4stm32.html).

This repository also contains useful 121GW-hardware-specific libraries in the `hw_lib/` directory.

## Features
* Project is fully IAP compatible
    * Programming the meter through its debug connector will not erase the bootloader.
    * The compiled firmware can be copied onto the SD card and programmed with the IAP routine without needing to open the meter or have a programmer.
    * Restoring the official firmware requires simply copying it to the SD card and programming it via the IAP routine. Calibration EEPROM data is not affected (assuming your custom firmware does not deliberately affect it).
* 121GW features are easily accessible
    * Most meter peripherals and hardware are pre-configured as they are in the default firmware and can be accessed using the HAL routines.
    * LCD library (`hw_lib/lcd/`) contains 100% complete segment map, plus functions for putting ASCII characters on the 7 segment displays.
    * More to come

## Usage
* Setting Up
    * Install SystemWorkbench
    * Clone the repository to your computer
    * Import the project into SystemWorkbench. Select File->Import... then General->Existing Projects into Workspace, and point to the cloned repository
* Programming via SWD
    * Connect your ST-Link (or compatible) programmer to the debug connector [as illustrated here](https://raw.githubusercontent.com/tpwrules/121gw-re/master/pdfs/swd%20pinout.jpg) 
    * Ensure your programmer is supplying power to the 3.3V pin, then turn on the meter with the range switch
    * Select 'Run' or 'Debug' from SystemWorkbench's Run menu
* Programming via IAP
    * Select Project -> Build Project from SystemWorkbench's menu
    * Put `Debug/EEVBlog.bin` on an SD card and insert it into the meter
    * Execute the IAP procedure as detailed in the meter's manual

## Contributing
If you would like to contribute, there are several areas for you to help with.

If you would like to change the STM32CubeMX project file, please open an issue describing the change.

If you would like to write a hardware library, please fork the repository, then open a pull request with your changes.

If you have another contribution or concern, please open an issue describing it.
